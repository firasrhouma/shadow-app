<section class="popular-products">
  <div class="container">
    <h2 class="section-title mb-4">Produits</h2>

    <div class="search-container mb-4">
      <input
        type="text"
        class="search-input form-control"
        placeholder="Rechercher des produits..."
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
      />
    </div>
    <div class="row g-4">
      <div
        class="col-sm-6 col-md-4 col-lg-3"
        *ngFor="let i of randomIndexesOfProducts"
      >
        <ng-container *ngIf="filteredProductList[i] as product">

          <div class="product-card card h-100 border-0">

            <!-- Bouton liste de souhaits -->
            <button
              class="wishlist-btn"
              (click)="toggleWishlist(product)"
            >
              <i
                class="bi"
                [ngClass]="
                  isItemInWishlist(product.id)
                    ? 'bi-heart-fill text-danger'
                    : 'bi-heart'
                "
              ></i>
            </button>

            <div class="product-image rounded-2 overflow-hidden" (click)="goToProduct(product.id)">
              <!-- pas d'images depuis le backend, donc image par défaut -->
              <img [src]="getProductImage(product.id)" [alt]="product.name" class="img-fluid product-thumbnail w-100" />
            </div>

            <div class="product-details p-3">
              <a [routerLink]="['/products', product.id]" class="text-decoration-none text-dark">
                <span class="product-category d-block">{{ product.category || 'Non catégorisé' }}</span>
                <h3 class="product-title one-line">{{ product.name }}</h3>
              </a>

              <p class="text-muted small mt-2">{{ product.description }}</p>

              <div class="d-flex justify-content-between align-items-center mt-2">
                <span class="price fw-bold text-danger fs-4">
                  {{ product.price }} DNT
                </span>
              </div>

              <!-- Voir détails -->
              <button
                class="add-to-cart-btn w-100 mt-3"
                [routerLink]="['/products', product.id]"
              >
                Voir détails
              </button>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</section>
